package org.glowa.danube.components.actor.tourism;

import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.File;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.PrintWriter;
import java.util.HashMap;
import java.util.Map;

import org.glowa.danube.components.actor.tourism.deeptourism.Tourism;
import org.glowa.danube.components.actor.tourism.utilities.TourismUtilities;
import org.glowa.danube.utilities.internal.DanubiaLogger;

/**
 * Tabel of all TourismGemeinde-Objects (Communities)
 * 
 * @author Dr. Alexander Dingedey alex@dingel.org, Dennis Joswig
 * @version 1.0
 */




public class TourismGemeindeTable {

	//Szenarioparamter 1 = Normal, Groesser 1 = Wachstum, kleiner 1 Schrumpfung

	private float naerholungsMetaFaktor = 1.0f;
	
	public int gmt = 1;
	public static final int Max_CountGemeinden = 2080;
	public Map<Long, TourismGemeinde> Gemeinde;
	public TourismGemeinde nullGemeinde;
	boolean logging = true;
	boolean firstTime = true;
	private static DanubiaLogger logger = DanubiaLogger.getDanubiaLogger(Tourism.class);
	
	

	/**
	 * Sets the societal scenario
	 * @param i The scenarionumber <code>1</code> = baseline, <code>2</code> = Liberal, <code>3</code> = Sustainable
	 */
	public void setGmt(int i)
	{
		gmt = i;
		switch (i)
		{
		case 1: 
		{naerholungsMetaFaktor = 1.0f;}
		break;
		case 2: 
		{naerholungsMetaFaktor = 1.01f;}
		break;
		case 3:
		{naerholungsMetaFaktor = 0.99f;}
		break;
		}
		
		for (TourismGemeinde g : this.Gemeinde.values())
		{
			g.setGmt(i);
		}		
		
		
	}
	
	/**
	 * Initialises TourismGemeindeTable based on data of data/actor/tourism/gemeindetable.txt. Default value = 0.
	 * @param startjahr year to start
	 */
	public TourismGemeindeTable(int startjahr) {

		/*
		 * Initialisiere alle Gemenden
		 */
		if (logging) {logger.debug("Initalisiere MyTourismGemeindeTable...");}

		nullGemeinde = new TourismGemeinde();
		nullGemeinde.init();
		
		Gemeinde = new HashMap<Long, TourismGemeinde>();

		// Daten Einlesen
		readGemeindeData();
		
				
		
		for (TourismGemeinde g : Gemeinde.values()) {
			g.prepareCalculations(startjahr);
		}
		
		if (logging) {logger.debug("Initialisierung GemeindeTable abgeschlossen!");}

	}// TourismGemeindeTable Constructor
	
	/**
	 * Resets all opening days.
	 */
	public void resetNaherholungsBetriebstage()
	{
		for (TourismGemeinde g : this.Gemeinde.values())
		{
			g.sumWaterPark = 0;
			g.sumOutdoorPool = 0;
			g.sumIndoorPool = 0;
			g.sumInAndOutdoorPool = 0;
			g.sumLido = 0;
			g.sumThermalspa = 0;
			g.sumGolfCourse = 0;
		}		
	}
	
	
	/**
	 * Calculates all maximum temperatures 
	 */
	public void calculateMaximum()
	{
		long tempMaxSumErlebnisbad = 1;
		long tempMaxSumFreibad = 1;
		long tempMaxSumHallenbad = 1;
		long tempMaxSumKombibad = 1;
		long tempMaxSumNaturbad = 1;
		long tempMaxSumThermalbad = 1;
		long tempMaxSumGolfplatz = 1;
		long tempMaxSumBurgSchloss = 1;
		long tempMaxSumDenkmal = 1;
		long tempMaxSumKirchen = 1;
		long tempMaxSumGastro = 1;
		long tempMaxSumNatGrassland = 1;
		long tempMaxSumResBuilding = 1;
		
		
		for (TourismGemeinde g : this.Gemeinde.values())
		{		
			if (g.sumWaterPark > tempMaxSumErlebnisbad)
				{tempMaxSumErlebnisbad = g.sumWaterPark;}
			if (g.sumOutdoorPool > tempMaxSumFreibad)
				{tempMaxSumFreibad = g.sumOutdoorPool;}
			if (g.sumIndoorPool > tempMaxSumHallenbad)
				{tempMaxSumHallenbad = g.sumIndoorPool;}
			if (g.sumInAndOutdoorPool > tempMaxSumKombibad)
				{tempMaxSumKombibad = g.sumInAndOutdoorPool;}
			if (g.sumLido > tempMaxSumNaturbad)
				{tempMaxSumNaturbad = g.sumLido;}
			if (g.sumThermalspa > tempMaxSumThermalbad)
				{tempMaxSumThermalbad = g.sumThermalspa;}
			if (g.sumGolfCourse > tempMaxSumGolfplatz)
				{tempMaxSumGolfplatz = g.sumGolfCourse;}
			if (g.sumCastel > tempMaxSumBurgSchloss)
				{tempMaxSumBurgSchloss = g.sumCastel;}
			if (g.sumMemorial > tempMaxSumDenkmal)
				{tempMaxSumDenkmal = g.sumMemorial;}
			if (g.sumChurch > tempMaxSumKirchen)
				{tempMaxSumKirchen = g.sumChurch;}
			if (g.sumGastro > tempMaxSumGastro)
				{tempMaxSumGastro = g.sumGastro;}
			if (g.sumGreenland > tempMaxSumNatGrassland)
				{tempMaxSumNatGrassland = g.sumGreenland;}
			if (g.sumdevelopement > tempMaxSumResBuilding)
				{tempMaxSumResBuilding = g.sumdevelopement;}
		}
			
		if (tempMaxSumErlebnisbad <= 0){tempMaxSumErlebnisbad = 1;}
		if (tempMaxSumFreibad <= 0){tempMaxSumFreibad = 1;}
		if (tempMaxSumHallenbad <= 0){tempMaxSumHallenbad = 1;}
		if (tempMaxSumKombibad <= 0){tempMaxSumKombibad = 1;}
		if (tempMaxSumNaturbad <= 0){tempMaxSumNaturbad = 1;}
		if (tempMaxSumThermalbad <= 0){tempMaxSumThermalbad = 1;}
		if (tempMaxSumGolfplatz <= 0){tempMaxSumGolfplatz = 1;}
		if (tempMaxSumBurgSchloss <= 0){tempMaxSumBurgSchloss = 1;}
		if (tempMaxSumDenkmal <= 0){tempMaxSumDenkmal = 1;}
		if (tempMaxSumKirchen <= 0){tempMaxSumKirchen = 1;}
		if (tempMaxSumGastro <= 0){tempMaxSumGastro = 1;}
		if (tempMaxSumNatGrassland <= 0){tempMaxSumNatGrassland = 1;}
		if (tempMaxSumResBuilding <= 0){tempMaxSumResBuilding = 1;}
		
		for (TourismGemeinde g : this.Gemeinde.values())
		{
			g.maxSumWaterPark = tempMaxSumErlebnisbad;
			g.maxSumOutdoorPool = tempMaxSumFreibad;
			g.maxSumInDoorPool = tempMaxSumHallenbad;
			g.maxSumInAndOutdoorPool = tempMaxSumKombibad;
			g.maxSumLido = tempMaxSumNaturbad;
			g.maxSumThermalspa = tempMaxSumThermalbad;
			g.maxSumGolfCourse = tempMaxSumGolfplatz;
			g.maxSumCastel = tempMaxSumBurgSchloss;
			g.maxSumMemorial = tempMaxSumDenkmal;
			g.maxSumChurch = tempMaxSumKirchen;
			g.maxSumGastro = tempMaxSumGastro;
			g.maxSumNatGrassland = tempMaxSumNatGrassland;
			g.maxSumResBuilding = tempMaxSumResBuilding;			
		}
		
	}
	
	/**
	 * Counts daily guests
	 * @param month Month to be count
	 * @param tpt TourismGemeindeTable
	 */
	public void countDailyGuests(int month,TourismProxelTable tpt)
	{
		double monAnt = 0d;
		TourismUtilities utility = new TourismUtilities();		
		long summePotAusfluegQuell = 0;
		
		switch (month)
		{
		case 1: monAnt = 1.108d;break;
		case 2: monAnt = 1.011d;break;
		case 3: monAnt = 1.088d;break;
		case 4: monAnt = 1.137d;break;
		case 5: monAnt = 1.124d;break;
		case 6: monAnt = 1.040d;break;
		case 7: monAnt = 1.066d;break;
		case 8: monAnt = 0.973d;break;
		case 9: monAnt = 0.955d;break;
		case 10: monAnt = 0.788d;break;
		case 11: monAnt = 0.832d;break;
		case 12: monAnt = 0.874d;break;
		}
		
		// Berechnung aller potentiellen Tagesausflugler
		
		for (TourismGemeinde g : this.Gemeinde.values())
		{
			g.potDailyGuestQuellGem = (long)((((double)g.population * g.excursionFrequency)/12d)*monAnt);
			summePotAusfluegQuell = summePotAusfluegQuell + g.potDailyGuestQuellGem;
		}

		
		double summeMult = 0.0d;
		double summeAdd = 0.0d;

		for (TourismGemeinde ZielGemeinde : this.Gemeinde.values())
		{
			TourismProxel ZielProxel = tpt.getTourismProxel(ZielGemeinde.zentroidPID);
									
			for (TourismGemeinde QuellGemeinde : this.Gemeinde.values())
			{			
				TourismProxel QuellProxel = tpt.getTourismProxel(QuellGemeinde.zentroidPID);
				double d;
					d =  (double)(utility.distanceOfProxels(ZielProxel,QuellProxel)/1000.0d);
					d = d + 5d;
					summeMult =  summeMult + (double)(ZielGemeinde.multAttracFactor * (double)Math.exp(Math.pow(d,-0.0257d)));
					summeAdd = summeAdd + (double)(ZielGemeinde.additivAttracFactor * (double)Math.pow(d,-0.7575d));			
			}
			
		}
		
		
		for (TourismGemeinde ZielGemeinde : this.Gemeinde.values())
		{
			TourismProxel ZielProxel = tpt.getTourismProxel(ZielGemeinde.zentroidPID);
			
			ZielGemeinde.propabilityMul = 0d;
			ZielGemeinde.propabilityAdd = 0d;
		
			for (TourismGemeinde QuellGemeinde : this.Gemeinde.values())
			{			
				TourismProxel QuellProxel = tpt.getTourismProxel(QuellGemeinde.zentroidPID);
				double d;
					d =  (double)(utility.distanceOfProxels(ZielProxel,QuellProxel)/1000.0f);
					d = d + 5;
					ZielGemeinde.propabilityMul = ZielGemeinde.propabilityMul + ((double)(ZielGemeinde.multAttracFactor * Math.exp(Math.pow(d,-0.0257d))) / summeMult);
					ZielGemeinde.propabilityAdd = ZielGemeinde.propabilityAdd + (((double)ZielGemeinde.additivAttracFactor * Math.pow(d,-0.7575d)) / summeAdd);
								
				}
			
			
			
			ZielGemeinde.numberDayGuests =
					((long)((1.35f * ZielGemeinde.propabilityMul * summePotAusfluegQuell) +
					(0.65f * ZielGemeinde.propabilityAdd * summePotAusfluegQuell)) / 2);
			if (ZielGemeinde.numberDayGuests <=0)
				{ZielGemeinde.numberDayGuests = 0;}

			float f = (float)ZielGemeinde.numberDayGuests * naerholungsMetaFaktor;
			ZielGemeinde.numberDayGuests = (long)f;
			}
		
		
	}
	
	/**
	 * Calculates the water usage
	 * @param month month of the year
	 * @param year year of calculation
	 */
	public void calculateWaterUsage(int month,int year)
	{		
		
		
	
			
			
		for (TourismGemeinde g : this.Gemeinde.values())
		{
			
			g.waterDemandMonthm3 = 
			(g.numberDayGuests * 0.5f * 0.025f * g.gastroActor.status) +
			((float)g.bedNightsPerMonth[month - 1] * 0.18f * (float)g.hotelActor.status);			
			if (g.waterDemandMonthm3 < 0)
			{
				g.waterDemandMonthm3 = 0;
			}
			
			g.wasteWaterMonthm3 = g.waterDemandMonthm3 * 0.95f;
		}			
	}
	
	

	/**
	 * Reads gemeinde Data.
	 */
	private void readGemeindeData() {
		int iterator;
		String line;
		int I_gemzaehler = 0;

		try {
			BufferedReader reader = new BufferedReader(new FileReader("data"
					+ File.separator + "tourism"
					+ File.separator + "gemeindetable.csv"));
			reader.readLine(); // Erste Zeile hat nur Datei-Infos!

			while ((line = reader.readLine()) != null) { // Liest Zeile aus
															// bis Datei-Ende

				// Variablendeklaration = 1. Hilfsvariable StringBuffer fuer
				// jerde einzelne Variable
				
				float f = 0f;
				
				StringBuffer ST_land = new StringBuffer(10);// Spalte 1 = Land
				StringBuffer ST_kreisid = new StringBuffer(10);// Spalte 2 = KreisID
				StringBuffer ST_gemid = new StringBuffer(12); // Spalte 3 = Gemeinde ID
				StringBuffer ST_achse = new StringBuffer(10); // Spalte 4 = Achsenabschnitt
				StringBuffer ST_steigung = new StringBuffer(10); // Spalte 5 = Steigung
				StringBuffer ST_betten = new StringBuffer(12);// Spalte 6 = Betten
				StringBuffer ST_betriebe = new StringBuffer(12);// Spalte 7 = HotelBetriebe
				StringBuffer ST_un_ant_jan = new StringBuffer(12);// Spalte 8 = Anteil Januar(1)
				StringBuffer ST_un_ant_feb = new StringBuffer(12);// Spalte 9 ­ Anteil Februar(2)
				StringBuffer ST_un_ant_mar = new StringBuffer(12);// Spalte 10 = Anteil Marz(3)
				StringBuffer ST_un_ant_apr = new StringBuffer(12);// Spalte 11 = Anteil  April(4)
				StringBuffer ST_un_ant_mai = new StringBuffer(12);// Spalte 12 = Anteil Mai(5)
				StringBuffer ST_un_ant_jun = new StringBuffer(12);// Spalte 13 = Anteil Juni(6)
				StringBuffer ST_un_ant_jul = new StringBuffer(12);// Spalte 14 = Anteil Juli(7)
				StringBuffer ST_un_ant_aug = new StringBuffer(12);// Spalte 15 = Anteil August(8)
				StringBuffer ST_un_ant_sep = new StringBuffer(12);// Spalte 16 = Anteil September(9)
				StringBuffer ST_un_ant_okt = new StringBuffer(12);// Spalte 17 = Anteil Oktober(10)
				StringBuffer ST_un_ant_nov = new StringBuffer(12);// Spalte 18 = Anteil November(11)
				StringBuffer ST_un_ant_dez = new StringBuffer(12);// Spalte 19 = Anteil Dezember(12)
				StringBuffer ST_anschlussgrad = new StringBuffer(12);// Spalte 20 Anschlussgrad Wasserversorgung
				StringBuffer st_zentroidPID = new StringBuffer(12);// Spalte 21 Zentroid PID der Gemeinde
				StringBuffer st_umfang = new StringBuffer(12);// Spalte 22 Umfang GEmdein
				StringBuffer st_ausfluege = new StringBuffer(12);// Spalte 23 Ausflugshaufigkeit
				StringBuffer st_bev = new StringBuffer(12);// Spalte 24 Bevoelkerung Init
				StringBuffer st_mitteltemp = new StringBuffer(12);//Spalte 25 Mitteltemperatur
				StringBuffer st_windersportinduzGEm = new StringBuffer(12);//Spalte 26 Wintersportinduz. Gemeinde
				StringBuffer st_sumBurgSchloss = new StringBuffer(12);//Spalte 27 Anzahl Burgen/Schloesser
				StringBuffer st_sumDenkmal = new StringBuffer(12);//Spalte 28 Anzahl DenkmŠler
				StringBuffer st_sumKirchen = new StringBuffer(12);//Spalte 	29 Anzahl Kirchen
				StringBuffer st_sumGastro = new StringBuffer(12);//Spalte 30 Anzahl Gaststaetten
				StringBuffer st_sumNatGrassland = new StringBuffer(12);//Spalte 31 Summe Natuerliches Grassland
				StringBuffer st_sumResBuilding= new StringBuffer(12);//Spalte 32 Summe Bebauung

				
				// ****** Schritt 1 Alle einzelnen Variablen pro Zeile in einen
				// String				
				
				iterator = 0;
				// Spalte 1 Auslesen Land
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					ST_land.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;

				// Spalte 2 Auslesen KreisID
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					ST_kreisid.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;

				// Spalte 3 Gemeinde ID
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					ST_gemid.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;

				// Spalte 4 Achse
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					ST_achse.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;

				// Spalte 5 Wachstum
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					ST_steigung.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;

				// Spalte 6 Betten
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					ST_betten.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;

				// Spalte 7 Betriebe
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					ST_betriebe.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;

				// Spalte 8 Anteil Januar(1)
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					ST_un_ant_jan.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;

				// Spalte 9 Anteil Februar(2)
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					ST_un_ant_feb.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;

				// Spalte 10 Anteil Marz(3)
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					ST_un_ant_mar.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;

				// Spalte 11 Anteil April(4)
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					ST_un_ant_apr.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;

				// Spalte 12 Anteil Mai(5)
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					ST_un_ant_mai.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;

				// Spalte 13 Anteil Juni(6)
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					ST_un_ant_jun.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;

				// Spalte 14 Anteil Juli(7)
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					ST_un_ant_jul.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;

				// Spalte 15 Anteil August(8)
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					ST_un_ant_aug.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;

				// Spalte 16 Anteil September(9)
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					ST_un_ant_sep.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;

				// Spalte 17 Anteil Oktober(10)
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					ST_un_ant_okt.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;

				// Spalte 18 Anteil November(11)
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					ST_un_ant_nov.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;

				// Spalte 19 Anteil Dezember(12)
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					ST_un_ant_dez.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;

				// Spalte 20 Anschlussgrad
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					ST_anschlussgrad.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;
				
				// Spalte 21 Zentroid PID
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					st_zentroidPID.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;

				// Spalte 22 Umfang
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					st_umfang.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;

				// Spalte 23 Ausfluege
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					st_ausfluege.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;

				// Spalte 24 Bevoelkerung
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					st_bev.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;
				
				// Spalte 25 Mitteltemperatur der Gemeinde
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					st_mitteltemp.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;
				
				// Spalte 26 Wintersportinduzierte Uebernachtungen
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					st_windersportinduzGEm.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;
				
				// Spalte 27 Wintersportinduzierte Uebernachtungen
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					st_sumBurgSchloss.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;

				// Spalte 28 Summme Denkmaeler
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					st_sumDenkmal.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;
				
				// Spalte 29 Summme Denkmaeler
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					st_sumKirchen.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;
				
				// Spalte 30 Summme Denkmaeler
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					st_sumGastro.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;

				// Spalte 28 Summme Denkmaeler
				while (line.charAt(iterator) != ';' && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					st_sumNatGrassland.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;

				// Spalte 32 Summe Residenital Buildings				
				while (iterator < line.length() && line.charAt(iterator) != '\t' && line.charAt(iterator) != ' ') {
					st_sumResBuilding.append(line.charAt(iterator));
					iterator++;
				} // while
				iterator++;
				

				// 2. Echte Werte werden in die Gemeindetabelle geschrieben
				TourismGemeinde tempGemeinde = new TourismGemeinde();
				tempGemeinde.init();
				
				
				// 1 Land ID				
				try {tempGemeinde.countryId = Integer.parseInt(ST_land.toString());}
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 1 Land - Zeile " + line.toString());}}

				// 2 Kreis ID
				try {tempGemeinde.kreisID = Long.parseLong(ST_kreisid.toString());} // try
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 2 KreisID - Zeile " + line.toString());}}

				// 3 Gem ID
				try {tempGemeinde.gemID = Long.parseLong(ST_gemid.toString());}
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 3 GemeindeID - Zeile " + line.toString());}}

				// 4 Achse
				try {tempGemeinde.axis = Long.parseLong(ST_achse.toString());} // try
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 4 Achse - Zeile " + line.toString());}}

				// 5 Steigung
				try {tempGemeinde.gradient = Float.parseFloat(ST_steigung.toString());} // try
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 5 Steigung - Zeile " + line.toString());}}

				// 6 Betten (Long)
				try {tempGemeinde.beds = Long.parseLong(ST_betten.toString());} // try
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 6 Betten - Zeile " + line.toString());}}

				// 7 Betriebe
				try {tempGemeinde.operators = Long.parseLong(ST_betriebe.toString());} // try
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 7 Betriebe - Zeile " + line.toString());}}
				
				// 8 Anteil Januar
				try {f = Float.parseFloat(ST_un_ant_jan.toString());
					tempGemeinde.setUebAnt(1, f);
				} // try
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 8 Anteil Januar - Zeile "+ line.toString());}}

				// 9 Anteil Februar
				try {f = Float.parseFloat(ST_un_ant_feb.toString());
					tempGemeinde.setUebAnt(2, f);
				} // try
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 9 Anteil Februar - Zeile " + line.toString());}}

				// 10 Anteil Maerz
				try {f = Float.parseFloat(ST_un_ant_mar.toString());
					tempGemeinde.setUebAnt(3, f);
				} // try
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 10 Anteil Maerz - Zeile " + line.toString());}}

				// 11 Anteil April
				try {f = Float.parseFloat(ST_un_ant_apr.toString());
					tempGemeinde.setUebAnt(4, f);
				} // try
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 11 Anteil April - Zeile "+ line.toString());}}

				// 12 Anteil Mai
				try {f = Float.parseFloat(ST_un_ant_mai.toString());
				tempGemeinde.setUebAnt(5, f);} // try
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 12 Anteil Mai - Zeile "+ line.toString());}}

				// 13 Anteil Juni
				try {f = Float.parseFloat(ST_un_ant_jun.toString());
					tempGemeinde.setUebAnt(6, f);} // try
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 13 Anteil Juni - Zeile "+ line.toString());}}

				// 14 Anteil Juli
				try {f = Float.parseFloat(ST_un_ant_jul.toString());
					tempGemeinde.setUebAnt(7, f);} // try
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 14 Anteil Juli - Zeile " + line.toString());}}

				// 15 Anteil August
				try {f = Float.parseFloat(ST_un_ant_aug.toString());
					tempGemeinde.setUebAnt(8, f);} // try
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 15 Anteil August - Zeile "+ line.toString());}}

				// 16 Anteil September
				try {f = Float.parseFloat(ST_un_ant_sep.toString());
				tempGemeinde.setUebAnt(9, f);} // try
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 16 Anteil Sep - Zeile "+ line.toString());}}

				// 17 Anteil Oktober
				try {f = Float.parseFloat(ST_un_ant_okt.toString());
					tempGemeinde.setUebAnt(10, f);} // try
				catch (NumberFormatException nfe) {
					if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 17 Anteil Oktober - Zeile "+ line.toString());}}

				// 18 Anteil November
				try {f = Float.parseFloat(ST_un_ant_nov.toString());
					tempGemeinde.setUebAnt(11, f);} // try
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 18 Anteil November - Zeile " + line.toString());}}

				// 19 Anteil Dezember
				try {f = Float.parseFloat(ST_un_ant_dez.toString());
					tempGemeinde.setUebAnt(12, f);}
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 19 Anteil Dezember - Zeile "+ line.toString());}}

				// 20 Anschlussgrad (float)
				try {tempGemeinde.anschlussgrad = Float.parseFloat(ST_anschlussgrad.toString());}
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 20 Anschlussgrad - Zeile "+ line.toString());}}

				// 21 Zentroid_Pid (int)
				try {tempGemeinde.zentroidPID = Integer.parseInt(st_zentroidPID.toString());} // try
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 21 Zentroid_PID - Zeile "+ line.toString());}}

				// 22 Umfang
				try {tempGemeinde.scope = Float.parseFloat(st_umfang.toString());} // try
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 22 Umfang - Zeile "+ line.toString());}}

				// 23 Ausflugsrate
				try {tempGemeinde.excursionFrequency = Float.parseFloat(st_ausfluege.toString());} // try
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 23 ausflug - Zeile " + line.toString());}}

				// 24 Bevoelkerung
				try {tempGemeinde.population = Long.parseLong(st_bev.toString());} // try
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 24 bevoelkerung - Zeile "+ line.toString());}}
				
				//25 st_mitteltemp
				try {tempGemeinde.averageTemp = Float.parseFloat(st_mitteltemp.toString());} // try
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 25 Mitteltemp - Zeile "	+ line.toString());}}
				
				//26 st_windersportinduzGEm
				try {tempGemeinde.wintersportIntensKl = Integer.parseInt(st_windersportinduzGEm.toString());} // try
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 26 Winterpsortklasse. Gmeinde - Zeile "+ line.toString());}}
		
				//27 st_sumBurgSchloss
				try {tempGemeinde.sumCastel = Integer.parseInt(st_sumBurgSchloss.toString());} // try
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 27 BurgSchloss - Zeile "+ line.toString());}}

				//28 st_sumDenkmal
				try {tempGemeinde.sumMemorial = Integer.parseInt(st_sumDenkmal.toString());} // try
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 28 Denkmal - Zeile "+ line.toString());}}

				//29 st_sumKirchen
				try {tempGemeinde.sumChurch = Integer.parseInt(st_sumKirchen.toString());} // try
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 29  Kirchen- Zeile "+ line.toString());}}

				//30 st_sumGast
				try {tempGemeinde.sumGastro = Integer.parseInt(st_sumGastro.toString());} // try
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 30 Gastro - Zeile "+ line.toString());}}

				//31 st_sumNatGrassland
				try {tempGemeinde.sumGreenland = Integer.parseInt(st_sumNatGrassland.toString());} // try
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 31 Grassland- Zeile "+ line.toString());}}

				//32 st_sumResBuilding
				try {tempGemeinde.sumdevelopement = Integer.parseInt(st_sumResBuilding.toString());} // try
				catch (NumberFormatException nfe) {if (logging) {logger.fatal("Falscher Datentyp in proxeltable.txt - Spalte 32 Building - Zeile "+ line.toString());}}
				
				
				float ff = 0;

				for (int z = 1; z < 13; z++) 
					{ff = ff + tempGemeinde.getUebAnt(z);}
				
				if (ff < 0.9f)
					{ if (logging) {logger.fatal("Zeile " + I_gemzaehler+ "Uebernachtungsanteil zu klein!!!");}}

				if (ff > 1.1f) {if (logging) {logger.fatal("Zeile " + I_gemzaehler+ "Uebernachtungsanteil zu gross!!!");}}
				
				// Stelle Gemeinde in die HashTable ein
				Gemeinde.put((long)tempGemeinde.gemID, tempGemeinde);

				
				I_gemzaehler = I_gemzaehler + 1;
			} // while
			reader.close();
			reader = null;
		} catch (Exception e) {
			if (logging) {
				logger.fatal("Dateieinlesen aus gemeindetable.txt fehlgeschlagen"
								+ e.getLocalizedMessage());
			}
		}
		
		
		
	}// ReadGemeindeTable
	
	
	
	/**
	 * Writes out the Gemeinde Table into a Text-File.
	 * @param filename Filename for the GemeindeData
	 * @param filenameUeN Filename for a File where only the bednights are write out
	 * @param month month of the year(started with 1)
	 * @param year year to write out
	 */
	public void writeOut(String filename, String filenameUeN, int month, int year) {

		try {
			PrintWriter pw = new PrintWriter(filename);
			BufferedWriter bw = new BufferedWriter(new FileWriter(filenameUeN, true));
			
			if(firstTime){
				bw.write("Monat");
				for (TourismGemeinde g : this.Gemeinde.values()) {
					bw.write(";"+g.gemID);
				}
				bw.newLine();
				firstTime = false;
			}
			pw.println("GemID;bedNightsPerMonth;bedNigthsWithoutTemp;population;numberOfDailyGuets;monthlyMeanTemp;meanTemp;a_drinkingwater;a_swim;a_ski;a_temp;a_temp1;guestThatmoveSkiArea;skiCapBed;hotelStatus;gastroStatus;drinkingwaterConsumption");
			
			bw.write(""+year+"."+month);
			
			for (TourismGemeinde g : this.Gemeinde.values()) {
				String s = "";
				
					s = s + g.gemID + ";";
					s = s + g.bedNightsPerMonth[month-1] + ";";
					s = s + g.bedNightsPerMonthWithoutTemp[month-1] + ";";
					s = s + g.population + ";";
					s = s + g.numberDayGuests +";";
					s = s + g.a_debugMonthTemp +";";
					s = s + g.averageTemp + ";";
					s = s + g.a_drinkingWater+ ";";
					s = s + g.a_swim + ";";
					s = s + g.a_ski + ";";
					s = s + g.a_temp + ";";
					s = s + g.a_temp1 + ";";
					s = s + g.reductionSki + ";";
					s = s + g.skiingAreaCapacityInOperation + ";";
					s = s + g.hotelActor.status + ";";
					s = s + g.gastroActor.status + ";";
					s = s + g.waterDemandMonthm3 + ";";
				pw.println(s);
				
				String n = ";"+g.bedNightsPerMonth[month-1];
				bw.write(n);
				
			}
			bw.newLine();
			bw.flush();
			bw.close();
			pw.close();
			
			
			
			
			
		} catch (Exception e) {
		}

	}

}
